<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
    <title>åŒ–å­¦è¿è¿çœ‹--ç½®æ¢ååº”</title>
    <style>
       .card {
            font-size: 1.25rem;
            font-family: 'Arial', sans-serif;
            width: 120px;
            height: 120px;
        }

       .result-text {
            font-family: 'Georgia', serif;
        }

       .button-text {
            font-family: 'Verdana', sans-serif;
        }

       .tips-section {
            background-color: #f3f4f6;
            border-radius: 0.375rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

       .game-board-container {
            background-color: #e5e7eb;
            border-radius: 0.375rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 1.25rem;
            margin-bottom: 1.25rem;
        }

       .error-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

       .error-modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            text-align: center;
            color: black;
        }

       .result-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 101;
        }

       .result-modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            text-align: center;
            color: black;
        }

        @keyframes shake {
            0% {
                transform: translate(1px, 1px) rotate(0deg);
            }

            10% {
                transform: translate(-1px, -2px) rotate(-1deg);
            }

            20% {
                transform: translate(-3px, 0px) rotate(1deg);
            }

            30% {
                transform: translate(3px, 2px) rotate(0deg);
            }

            40% {
                transform: translate(1px, -1px) rotate(1deg);
            }

            50% {
                transform: translate(-1px, 2px) rotate(-1deg);
            }

            60% {
                transform: translate(-3px, 1px) rotate(0deg);
            }

            70% {
                transform: translate(3px, 1px) rotate(-1deg);
            }

            80% {
                transform: translate(-1px, -1px) rotate(1deg);
            }

            90% {
                transform: translate(1px, 2px) rotate(0deg);
            }

            100% {
                transform: translate(1px, -2px) rotate(-1deg);
            }
        }

       .shake {
            animation: shake 0.5s;
            animation-iteration-count: 1;
        }

       .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f00;
            clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
            animation: fall 3s linear infinite;
        }

        @keyframes fall {
            0% {
                top: -10%;
                transform: rotate(0deg);
            }

            100% {
                top: 100%;
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body class="font-inter bg-gray-100 flex justify-center items-center min-h-screen m-0">
    <div id="game-side" class="bg-white p-5 rounded-lg shadow-md">
        <h1 id="level-title" class="text-2xl font-bold text-center mb-6">åŒ–å­¦è¿è¿çœ‹--ç½®æ¢ååº” L1</h1>
        <div class="game-board-container">
            <div id="game-board" class="grid grid-cols-4 grid-rows-2 gap-2.5 m-5 mx-auto justify-center"></div>
        </div>
        <div id="result" class="text-center text-xl mt-5"></div>
        <div id="score-display" class="text-center text-xl mt-5">å½“å‰ç§¯åˆ†: 0</div>
        <div id="rank-display" class="text-center text-xl mt-2">é›†å®ç®±ï¼šæ‚¨å½“å‰æ”¶é›†äº† 0/60 ä¸ªç‰©è´¨</div>
        <div id="score-change" class="text-center text-lg mt-2.5 text-green-500"></div>
        <div id="tips" class="mt-10 p-5 tips-section">
            <h2 class="text-lg font-bold mb-2.5">æ¸¸æˆé—¯å…³å°æŠ€å·§</h2>
            <p class="leading-relaxed" id="tips-content"></p>
            <button id="knowledge-base-btn" class="mt-4 bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded button-text"
                onclick="openKnowledgeBase()">AIåŒ–å­¦çŸ¥è¯†åº“</button>
        </div>
    </div>
    <div class="confetti fixed top-0 left-0 w-full h-full pointer-events-none z-50" id="confetti"></div>
    <audio id="success-sound" src="https://www.soundjay.com/button/beep-07.wav"></audio>
    <audio id="fail-sound" src="https://www.soundjay.com/misc/fail-buzzer-01.wav"></audio>
    <audio id="background-music" src="https://cdn.pixabay.com/download/audio/2023/10/03/audio_616829d766.mp3?filename=positive-mind-118726.mp3"
        loop></audio>
    <button id="music-control" class="fixed top-4 right-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"
        onclick="toggleMusic()">
        <i class="fa-solid fa-volume-high"></i>
    </button>
    <div id="error-modal" class="error-modal">
        <div class="error-modal-content">
            <p>ä½ å·²ç»è¿ç»­ä¸¤æ¬¡é”™è¯¯é…å¯¹å•¦ğŸ˜”ï¼Œç‚¹å‡»â€œAIåŒ–å­¦çŸ¥è¯†åº“â€é¢†å–ğŸ</p>
            <div class="flex justify-between mt-4">
                <button class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded button-text"
                    onclick="openKnowledgeBase()">AIåŒ–å­¦çŸ¥è¯†åº“</button>
                <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded button-text"
                    onclick="closeErrorModal()">å…³é—­</button>
            </div>
        </div>
    </div>
    <div id="result-modal" class="result-modal">
        <div class="result-modal-content">
            <p id="result-modal-text"></p>
            <button class="mt-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded button-text"
                onclick="closeResultModal()">å…³é—­</button>
        </div>
    </div>
    <script>
        const L1_reactionPairs = [
            ["Mg", "ZnSOâ‚„"],
            ["Mg", "FeClâ‚ƒ"],
            ["Mg", "CuSOâ‚„"],
            ["Mg", "AgNOâ‚ƒ"],
            ["Zn", "FeClâ‚ƒ"],
            ["Zn", "CuSOâ‚„"],
            ["Zn", "AgNOâ‚ƒ"],
            ["Fe", "CuSOâ‚„"],
            ["Fe", "AgNOâ‚ƒ"],
            ["Cu", "AgNOâ‚ƒ"]
        ];
        const L1_allCards = ["é•", "é”Œ", "é“", "é“œ", "ç¡«é…¸é”Œ", "æ°¯åŒ–é“", "ç¡«é…¸é“œ", "ç¡é…¸é“¶"];
        const L1_metals = ["é•", "é”Œ", "é“", "é“œ"];
        const L1_compounds = ["ç¡«é…¸é”Œ", "æ°¯åŒ–é“", "ç¡«é…¸é“œ", "ç¡é…¸é“¶"];
        const L1_metalSymbols = { "é•": "Mg", "é”Œ": "Zn", "é“": "Fe", "é“œ": "Cu" };
        const L1_saltMap = { "ç¡«é…¸é”Œ": "ZnSOâ‚„", "æ°¯åŒ–é“": "FeClâ‚ƒ", "ç¡«é…¸é“œ": "CuSOâ‚„", "ç¡é…¸é“¶": "AgNOâ‚ƒ" };

        const L2_reactionPairs = [
            ["Al", "CuSOâ‚„"],
            ["Al", "AgNOâ‚ƒ"],
            ["Sn", "CuSOâ‚„"],
            ["Sn", "AgNOâ‚ƒ"],
            ["Pb", "CuSOâ‚„"],
            ["Pb", "AgNOâ‚ƒ"]
        ];
        const L2_allCards = ["é“", "é”¡", "é“…", "ç¡«é…¸é“œ", "ç¡é…¸é“¶"];
        const L2_metals = ["é“", "é”¡", "é“…"];
        const L2_compounds = ["ç¡«é…¸é“œ", "ç¡é…¸é“¶"];
        const L2_metalSymbols = { "é“": "Al", "é”¡": "Sn", "é“…": "Pb" };
        const L2_saltMap = { "ç¡«é…¸é“œ": "CuSOâ‚„", "ç¡é…¸é“¶": "AgNOâ‚ƒ" };

        const FULL_SCORE = 100;
        const PENALTY = 10;
        const MATCH_POINTS = 25;
        const MISMATCH_PENALTY = 10;

        const gameBoard = document.getElementById('game-board');
        const result = document.getElementById('result');
        const scoreDisplay = document.getElementById('score-display');
        const rankDisplay = document.getElementById('rank-display');
        const scoreChange = document.getElementById('score-change');
        const confetti = document.getElementById('confetti');
        const successSound = document.getElementById('success-sound');
        const failSound = document.getElementById('fail-sound');
        const backgroundMusic = document.getElementById('background-music');
        const musicControl = document.getElementById('music-control');
        const errorModal = document.getElementById('error-modal');
        const resultModal = document.getElementById('result-modal');
        const resultModalText = document.getElementById('result-modal-text');
        const levelTitle = document.getElementById('level-title');

        let currentLevel = 1;
        let firstCard = null;
        let secondCard = null;
        let matchedPairs = 0;
        let score = 0;
        let consecutiveFailures = 0;
        let incorrectPairs = [];
        let hasFailedMatch = false;
        let highestUnlockedCount = 0;
        let remainingTwoPairsFailures = 0;

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function setupGame() {
            let reactionPairs, allCards, metals, compounds, metalSymbols, saltMap;
            if (currentLevel === 1) {
                reactionPairs = L1_reactionPairs;
                allCards = L1_allCards;
                metals = L1_metals;
                compounds = L1_compounds;
                metalSymbols = L1_metalSymbols;
                saltMap = L1_saltMap;
                levelTitle.textContent = 'åŒ–å­¦è¿è¿çœ‹--ç½®æ¢ååº” L1';
            } else if (currentLevel === 2) {
                reactionPairs = L2_reactionPairs;
                allCards = L2_allCards;
                metals = L2_metals;
                compounds = L2_compounds;
                metalSymbols = L2_metalSymbols;
                saltMap = L2_saltMap;
                levelTitle.textContent = 'åŒ–å­¦è¿è¿çœ‹--ç½®æ¢ååº” L2';
            }
            const shuffledCards = shuffleArray(allCards);
            gameBoard.innerHTML = '';
            shuffledCards.forEach((cardText, index) => {
                const card = document.createElement('div');
                card.classList.add('card', 'bg-white', 'rounded-lg', 'shadow-md', 'flex', 'justify-center', 'items-center', 'text-base', 'cursor-pointer', 'transition-transform', 'duration-300', 'aspect-square');
                if (index % 4 === 0) {
                    card.classList.add('bg-pink-200');
                } else if (index % 4 === 1) {
                    card.classList.add('bg-sky-200');
                } else if (index % 4 === 2) {
                    card.classList.add('bg-green-200');
                } else {
                    card.classList.add('bg-yellow-200');
                }
                card.textContent = cardText;
                card.dataset.index = index;
                card.addEventListener('click', clickCard);
                gameBoard.appendChild(card);
            });
            document.getElementById('tips-content').textContent = '';
            updateRankDisplay();
        }

        function clickCard() {
            if (this.classList.contains('matched')) return;
            if (this.classList.contains('flipped')) {
                this.classList.remove('flipped');
                if (this === firstCard) {
                    firstCard = null;
                } else if (this === secondCard) {
                    secondCard = null;
                }
            } else {
                if (firstCard && secondCard) {
                    firstCard.classList.remove('flipped');
                    secondCard.classList.remove('flipped');
                    firstCard = null;
                    secondCard = null;
                }
                this.classList.add('flipped', 'rotate-y-180');
                if (!firstCard) {
                    firstCard = this;
                } else {
                    secondCard = this;
                    setTimeout(() => {
                        checkMatch();
                    }, 300);
                }
            }
        }

        function checkMatch() {
            if (!firstCard || !secondCard) return;
            let reactionPairs, metals, compounds, metalSymbols, saltMap;
            if (currentLevel === 1) {
                reactionPairs = L1_reactionPairs;
                metals = L1_metals;
                compounds = L1_compounds;
                metalSymbols = L1_metalSymbols;
                saltMap = L1_saltMap;
            } else if (currentLevel === 2) {
                reactionPairs = L2_reactionPairs;
                metals = L2_metals;
                compounds = L2_compounds;
                metalSymbols = L2_metalSymbols;
                saltMap = L2_saltMap;
            }
            const firstText = firstCard.textContent;
            const secondText = secondCard.textContent;
            if (metals.includes(firstText) && metals.includes(secondText) || compounds.includes(firstText) && compounds.includes(secondText)) {
                handleMismatch();
                return;
            }
            let metal, salt;
            if (metalSymbols[firstText] && saltMap[secondText]) {
                metal = metalSymbols[firstText];
                salt = saltMap[secondText];
            } else if (metalSymbols[secondText] && saltMap[firstText]) {
                metal = metalSymbols[secondText];
                salt = saltMap[firstText];
            } else {
                handleMismatch();
                return;
            }
            const isMatch = reactionPairs.some(pair => pair[0] === metal && pair[1] === salt);
            if (isMatch) {
                handleMatch(metal, salt);
            } else {
                handleMismatch();
            }
            firstCard = null;
            secondCard = null;
        }

        function handleMatch(metal, salt) {
            consecutiveFailures = 0;
            remainingTwoPairsFailures = 0;
            firstCard.classList.add('matched', 'invisible');
            secondCard.classList.add('matched', 'invisible');
            matchedPairs++;
            score += MATCH_POINTS;
            updateScoreDisplay();
            updateHighestUnlockedCount();
            updateRankDisplay();
            scoreChange.textContent = `åŒ¹é…æˆåŠŸï¼Œè·å¾— ${MATCH_POINTS} åˆ†`;
            scoreChange.style.color = 'green';
            playSuccessEffect();
            setTimeout(() => {
                scoreChange.textContent = '';
            }, 2000);
            const remainingCards = document.querySelectorAll('.card:not(.matched)').length;
            if (remainingCards === 0) {
                if (currentLevel === 1) {
                    if (score >= 100) {
                        currentLevel = 2;
                        resetGame();
                    } else {
                        showLowScoreInfo();
                        openResultModal('é—¯å…³æˆåŠŸäº†ï¼Œä½†æ˜¯é—¯å…³è´¨é‡æœ‰ç‚¹ä½å“¦ï¼Œ100ç§¯åˆ†å³å¯è¿›å…¥L2å…³å¡', true);
                    }
                } else {
                    showVictory();
                    openResultModal('é—¯å…³æˆåŠŸï¼', true);
                }
            }
        }

        function handleMismatch() {
            firstCard.classList.remove('flipped', 'rotate-y-180');
            secondCard.classList.remove('flipped', 'rotate-y-180');
            score -= MISMATCH_PENALTY;
            consecutiveFailures++;
            updateScoreDisplay();
            updateRankDisplay();
            const remainingCards = document.querySelectorAll('.card:not(.matched)').length;
            const firstText = firstCard.textContent;
            const secondText = secondCard.textContent;
            let reactionPairs, metals, metalSymbols, saltMap;
            if (currentLevel === 1) {
                reactionPairs = L1_reactionPairs;
                metals = L1_metals;
                metalSymbols = L1_metalSymbols;
                saltMap = L1_saltMap;
            } else if (currentLevel === 2) {
                reactionPairs = L2_reactionPairs;
                metals = L2_metals;
                compounds = L2_compounds;
                metalSymbols = L2_metalSymbols;
                saltMap = L2_saltMap;
            }
            let metal = metalSymbols[metals.find(m => m === firstText) || metals.find(m => m === secondText)];
            let correctPair = reactionPairs.find(pair => pair[0] === metal);
            let correctSubstance = correctPair? correctPair[1] : "";
            let correctCardText = Object.keys(saltMap).find(key => saltMap[key] === correctSubstance);

            const sortedPair = [firstText, secondText].sort().join('|');
            const isDuplicate = incorrectPairs.some(pair => {
                const existingSortedPair = [pair.wrong[0], pair.wrong[1]].sort().join('|');
                return existingSortedPair === sortedPair;
            });

            if (!isDuplicate) {
                incorrectPairs.push({ wrong: [firstText, secondText], correct: [metal, correctCardText] });
            }

            if (remainingCards === 4) {
                remainingTwoPairsFailures++;
                if (remainingTwoPairsFailures >= 3) {
                    const lastPair = [firstText, secondText].sort();
                    const lastPairKey = lastPair.join('|');
                    const isLastPairDuplicate = incorrectPairs.some(pair => {
                        const existingPair = [pair.wrong[0], pair.wrong[1]].sort();
                        const existingPairKey = existingPair.join('|');
                        return existingPairKey === lastPairKey;
                    });
                    if (!isLastPairDuplicate) {
                        incorrectPairs.push({ wrong: lastPair, correct: [metal, correctCardText] });
                    }
                    showGameOver();
                    openResultModal(`é—¯å…³å¤±è´¥ï¼å½“å‰ç§¯åˆ†: ${score}ã€‚æ‚¨å½“å‰æ”¶é›†äº† ${matchedPairs * 2}/60 ä¸ªç‰©è´¨ï½ç»§ç»­åŠ æ²¹å“¦ï½æ”¶é›†åˆ°10ä¸ªç‰©è´¨å³å¯è§£é”L2å…³å¡ğŸ’ª`, false);
                    return;
                }
            } else if ((remainingCards === 2 && consecutiveFailures >= 1)) {
                const lastPair = [firstText, secondText].sort();
                const lastPairKey = lastPair.join('|');
                const isLastPairDuplicate = incorrectPairs.some(pair => {
                    const existingPair = [pair.wrong[0], pair.wrong[1]].sort();
                    const existingPairKey = existingPair.join('|');
                    return existingPairKey === lastPairKey;
                });
                if (!isLastPairDuplicate) {
                    incorrectPairs.push({ wrong: lastPair, correct: [metal, correctCardText] });
                }
                showGameOver();
                openResultModal(`é—¯å…³å¤±è´¥ï¼å½“å‰ç§¯åˆ†: ${score}ã€‚æ‚¨å½“å‰æ”¶é›†äº† ${matchedPairs * 2}/60 ä¸ªç‰©è´¨ï½ç»§ç»­åŠ æ²¹å“¦ï½æ”¶é›†åˆ°10ä¸ªç‰©è´¨å³å¯è§£é”L2å…³å¡ğŸ’ª`, false);
                return;
            }

            if (consecutiveFailures >= 2) {
                scoreChange.textContent = `åŒ¹é…å¤±è´¥ï¼Œæ‰£é™¤ ${MISMATCH_PENALTY} åˆ†ã€‚æœ¬æ¬¡é”™è¯¯é…å¯¹ä¸ºï¼š${firstText} å’Œ ${secondText}`;
                openErrorModal();
            } else {
                if (metals.includes(firstCard.textContent) && metals.includes(secondCard.textContent)) {
                    scoreChange.textContent = `åŒ¹é…å¤±è´¥ï¼Œæ‰£é™¤ ${MISMATCH_PENALTY} åˆ†ã€‚é‡‘å±å’Œé‡‘å±æ˜¯ä¸èƒ½ååº”çš„å“¦`;
                } else if (compounds.includes(firstCard.textContent) && compounds.includes(secondCard.textContent)) {
                    scoreChange.textContent = `åŒ¹é…å¤±è´¥ï¼Œæ‰£é™¤ ${MISMATCH_PENALTY} åˆ†ã€‚ä¸å¯¹å“¦`;
                } else {
                    scoreChange.textContent = `åŒ¹é…å¤±è´¥ï¼Œæ‰£é™¤ ${MISMATCH_PENALTY} åˆ†`;
                }
            }
            scoreChange.style.color = 'red';
            playFailEffect();
            setTimeout(() => {
                scoreChange.textContent = '';
            }, 2000);

            hasFailedMatch = true;
            updateTipsContent();
        }

        function showGameOver() {
            updateTipsContent();
            result.innerHTML = `<span class="text-5xl font-bold text-red-500 result-text">é—¯å…³å¤±è´¥</span><br>
                <button id="play-again" class="mt-8 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded button-text" onclick="resetGame()">å†ç©ä¸€æ¬¡</button>
                <button id="videoç§‘æ™®" class="mt-8 bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded button-text" onclick="openVideoPage()">è§†é¢‘ç§‘æ™®</button>`;
        }

        function showVictory() {
            updateTipsContent();
            if (incorrectPairs.length > 0) {
                let tipText = "ä»¥ä¸‹æ˜¯ä½ åœ¨æ¸¸æˆä¸­å‡ºç°çš„é”™è¯¯é…å¯¹ï¼š<br>";
                incorrectPairs.forEach(pair => {
                    tipText += `é”™è¯¯é…å¯¹ï¼š${pair.wrong[0]} å’Œ ${pair.wrong[1]}<br>`;
                });
                document.getElementById('tips-content').innerHTML = tipText;
            } else {
                document.getElementById('tips-content').textContent = "ä½ åœ¨æ¸¸æˆä¸­æ²¡æœ‰å‡ºç°é”™è¯¯é…å¯¹ï¼Œéå¸¸æ£’ï¼";
            }
            result.innerHTML = `<span class="text-5xl font-bold text-green-500 result-text">èƒœåˆ©</span><br>
                <button id="play-again" class="mt-8 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded button-text" onclick="resetGame()">å†ç©ä¸€æ¬¡</button>
                <button id="videoç§‘æ™®" class="mt-8 bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded button-text" onclick="openVideoPage()">è§†é¢‘ç§‘æ™®</button>`;
        }

        function showLowScoreInfo() {
            updateTipsContent();
            result.innerHTML = `<span class="text-5xl font-bold text-yellow-500 result-text">100ç§¯åˆ†å³å¯è¿›å…¥L2å…³å¡</span><br>
                <button id="play-again" class="mt-8 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded button-text" onclick="resetGame()">å†ç©ä¸€æ¬¡</button>
                <button id="videoç§‘æ™®" class="mt-8 bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded button-text" onclick="openVideoPage()">è§†é¢‘ç§‘æ™®</button>`;
        }

        function updateScoreDisplay() {
            scoreDisplay.textContent = `å½“å‰ç§¯åˆ†: ${score}`;
        }

        function playSuccessEffect() {
            successSound.play();
            createConfetti();
            setTimeout(() => {
                confetti.innerHTML = '';
            }, 3000);
        }

        function playFailEffect() {
            failSound.play();
            firstCard.classList.add('shake');
            secondCard.classList.add('shake');
            setTimeout(() => {
                firstCard.classList.remove('shake');
                secondCard.classList.remove('shake');
            }, 500);
        }

        function createConfetti() {
            const colors = ['#FF6633', '#FFB399', '#FF33FF', '#FFFF99', '#00B3E6',
                '#E6B333', '#3366E6', '#999966', '#99FF99', '#B34D4D',
                '#80B300', '#809900', '#E6B3B3', '#6680B3', '#66991A',
                '#FF99E6', '#CCFF1A', '#FF1A66', '#E6331A', '#33FFCC',
                '#66994D', '#B366CC', '#4D8000', '#B33300', '#CC80CC',
                '#66664D', '#991AFF', '#E666FF', '#4DB3FF', '#1AB399',
                '#E666B3', '#33991A', '#CC9999', '#B3B31A', '#00E680',
                '#4D8066', '#809980', '#E6FF80', '#1AFF33', '#999933',
                '#FF3380', '#CCCC00', '#66E64D', '#4D80CC', '#9900B3',
                '#E64D66', '#4DB380', '#FF4D4D', '#99E6E6', '#6666FF'];
            for (let i = 0; i < 100; i++) {
                const confettiPiece = document.createElement('div');
                confettiPiece.classList.add('confetti-piece');
                confettiPiece.style.left = `${Math.random() * 100}vw`;
                confettiPiece.style.animationDuration = `${Math.random() * 3 + 2}s`;
                confettiPiece.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.appendChild(confettiPiece);
            }
        }

        function updateRankDisplay() {
            rankDisplay.textContent = `é›†å®ç®±ï¼šæ‚¨å½“å‰æ”¶é›†äº† ${matchedPairs * 2}/60 ä¸ªç‰©è´¨`;
        }

        function updateHighestUnlockedCount() {
            highestUnlockedCount = Math.max(highestUnlockedCount, matchedPairs * 2);
        }

        function updateTipsContent() {
            if (hasFailedMatch) {
                let tipText = "ä»¥ä¸‹æ˜¯ä½ åœ¨æ¸¸æˆä¸­å‡ºç°çš„é”™è¯¯é…å¯¹ï¼š<br>";
                incorrectPairs.forEach(pair => {
                    tipText += `é”™è¯¯é…å¯¹ï¼š${pair.wrong[0]} å’Œ ${pair.wrong[1]}<br>`;
                });
                document.getElementById('tips-content').innerHTML = tipText;
            } else {
                document.getElementById('tips-content').textContent = '';
            }
        }

        function openKnowledgeBase() {
            window.open('https://www.zhizhen.com', '_blank');
        }

        function openVideoPage() {
            window.open('https://www.bilibili.com', '_blank');
        }

        function toggleMusic() {
            if (backgroundMusic.paused) {
                backgroundMusic.play();
                musicControl.innerHTML = '<i class="fa-solid fa-volume-high"></i>';
            } else {
                backgroundMusic.pause();
                musicControl.innerHTML = '<i class="fa-solid fa-volume-xmark"></i>';
            }
        }

        function openErrorModal() {
            errorModal.style.display = 'flex';
        }

        function closeErrorModal() {
            errorModal.style.display = 'none';
        }

        function openResultModal(message, isSuccess) {
            resultModalText.textContent = message;
            resultModal.style.display = 'flex';
            if (isSuccess) {
                playSuccessEffect();
            } else {
                playFailEffect();
            }
        }

        function closeResultModal() {
            resultModal.style.display = 'none';
        }

        function resetGame() {
            firstCard = null;
            secondCard = null;
            matchedPairs = 0;
            score = 0;
            consecutiveFailures = 0;
            incorrectPairs = [];
            hasFailedMatch = false;
            remainingTwoPairsFailures = 0;
            gameBoard.innerHTML = '';
            result.innerHTML = '';
            scoreDisplay.textContent = 'å½“å‰ç§¯åˆ†: 0';
            rankDisplay.textContent = 'é›†å®ç®±ï¼šæ‚¨å½“å‰æ”¶é›†äº† 0/60 ä¸ªç‰©è´¨';
            scoreChange.textContent = '';
            setupGame();
        }

        setupGame();
        backgroundMusic.play();
    </script>
</body>

</html>
    